---
title: "Avoidance-Attraction Ratios in R"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Avoidance-Attraction Ratios in R}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Avoidance-Attraction Ratios were first developed by Parsons et al. 2016 to investigate the effects of humans and their favorite companion, dogs, on wildlife. Since then Avoidance-Attraction Ratios have grown in popularity due to their ability to gain insights into species interactions at a fine temporal scale.

This guide will implement the functions in the AvoidAttract package and perform an analysis of species interactions using Avoidance-Attraction Ratios having coyotes (*Canis latrans*) as the predator species. The data that we will use is integrated in the package and is from a camera trapping project in western Kansas, source: Palomo-Munoz et al. 2023.

Lets get started.

```{r setup}
# Install the package
devtools::install_github("dpearcetamu/AvoidAttract", quiet = TRUE)

# Load the package
library(AvoidAttract)
```

Now that the package is installed and loaded, let's take a look at the data.

```{r data documentation}
# If you want to take a closer look use this code to read the dataset documentation, 
# ?KScams_dat
```

Okay, now that we've seen the details of the camera trapping data, lets load it into the environment and take a closer look.

```{r reading in data}
# Reading in the data
data("KScams_dat")

# Let's take a look
head(KScams_dat)
```

Great! We can see that the data has detection's of species at certain sites with a specific date and time for that observation. Let's see how many different species were found.

``` {r looking into the data}
# Let's see what the column names are 
names(KScams_dat)

# What were the unique species using the "Common_name" column
unique(KScams_dat$Common_name)
```

Looking to see how many observations of each species there are in the data set using the spp_sum function from the package.
```{r species observations}
# spp_sum requires the data input and a name column and provides a frequency table of observations
spp_sum(KScams_dat, name_col = "Common_name")

```

That's a lot of observations! Let's take a look at a few of the species that had a lot of observations and their interactions with coyotes using the AAR function.  
```{r AAR function}
# First we have to format the DateTime column from a character string to a date time 
# This is an important step since the function won't know how to read the date and time
# Make sure to modify the format if you are using a different dataset!!!
KScams_dat$DateTime  <- as.POSIXct(KScams_dat$DateTime ,  tryFormats = "%m/%d/%Y %H:%M:%OS")

# Let's look at some of these species!

# Starting with the Black-tailed jackrabbit 
jrabbit_AAR <- AAR(data = KScams_dat, speciesA = "Black-tailed jackrabbit", speciesB = "Coyote",
                   species_col = "Common_name", datetime_col = "DateTime", 
                   site_col ="Site", unitTime = "hours")

# The AAR function outputs several results. Let's take a look at just the total summary.
print(jrabbit_AAR$total_summary)

# Okay we can see that this outputs the mean values for all interaction events and the interaction ratios

# The AAR function also returns a list of how many times those interactions occurred.
print(jrabbit_AAR$event_count)

# That's quite a few counts for each interaction.
# Lets save just the ratios to use later on.

# Saving only the T2/T1 and T4/T3 ratios 
jrabbit_ratios <- jrabbit_AAR$total_summary[c(5,6)]

# Now the other species

# Black-tailed Prarie Dog
pdog_AAR <- AAR(data = KScams_dat, speciesA = "Black-tailed Prarie Dog", speciesB = "Coyote",
                species_col = "Common_name", datetime_col = "DateTime", 
                site_col ="Site", unitTime = "hours")

pdog_ratios <- pdog_AAR$total_summary[c(5,6)]

# Eastern cottontail rabbit
crabbit_AAR<- AAR(data = KScams_dat, speciesA = "Eastern cottontail rabbit", speciesB = "Coyote",
                  species_col = "Common_name", datetime_col = "DateTime", 
                  site_col ="Site", unitTime = "hours")

crabbit_ratios <- crabbit_AAR$total_summary[c(5,6)]


# Mouse
mouse_AAR <- AAR(data = KScams_dat, speciesA = "Mouse", speciesB = "Coyote",
                 species_col = "Common_name", datetime_col = "DateTime", 
                 site_col ="Site", unitTime = "hours")

mouse_ratios <- mouse_AAR$total_summary[c(5,6)]

# Norway rat
rat_AAR <- AAR(data = KScams_dat, speciesA = "Norway rat", speciesB = "Coyote",
               species_col = "Common_name", datetime_col = "DateTime", 
               site_col ="Site", unitTime = "hours")

rat_ratios <- rat_AAR$total_summary[c(5,6)]

# White-tailed Deer
wtd_AAR <- AAR(data = KScams_dat, speciesA = "White-Tailed Deer", speciesB = "Coyote",
               species_col = "Common_name", datetime_col = "DateTime", 
               site_col ="Site", unitTime = "hours")


wtd_ratios <- wtd_AAR$total_summary[c(5,6)]

```

Okay, now lets combine all of the summaries into one dataframe.
```{r combine summaries}
# Combining ratio data
combined_ratios <- as.data.frame(rbind(Jack_rabbit = jrabbit_ratios, 
                                     Prarie_dog = pdog_ratios,
                                     cottontail_rabbit = crabbit_ratios,
                                     Mouse = mouse_ratios,
                                     Norway_rat = rat_ratios,
                                     wt_Deer = wtd_ratios))

# Adding a column for species names
combined_ratios$Species  <- c("Jack rabbit", "Prarie dog", 
                              "Cottontail rabbit", "Mouse", "Norway rat", "wt Deer")

# Future steps require that the data be in a long format. 
# Let's convert the data from a wide format to long format.
combined_ratios_long <- tidyr::gather(combined_ratios, key = "Ratio", 
                                      value = "Value", -Species)
# Take a quick look
print(combined_ratios)
```

Let's plot both of the ratios and take a look.

```{r fig.width=8, fig.height=6}
# Let's plot the ratios with ggplot2
library(ggplot2)

# Plotting
ggplot(combined_ratios_long, aes(x = Species, y = Value, fill = Ratio)) +
  geom_col(position = position_dodge(0.8), width = 0.7) +
  geom_text(aes(label = round(Value, 2)), position = position_dodge(0.8), vjust = -0.5) +
  scale_fill_manual(values = c("black", "grey"), name = "Ratio") +  
  labs(x = "Species", y = "Avoidance-Attraction Ratios", 
       title = "Prey Avoidance and Coyote Attraction") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        panel.background = element_rect(fill = "white"))



```


From Parsons (2016) we know that the T2/T1 (BA/AB) ratio could be influenced both by the avoidance of the species A and the attraction of species B and the T4/T3 ratio describes the avoidance of species A from species B. We also know that values >1 for T2/T1 or T4/T3 suggest nonrandom movement between the two species and attraction of species B to species A could also result in high T2/T1 ratios, but would result in lower ratios of T4/T3. We also know that lower T2/T1 ratios but higher T4/T3 ratios would suggest that species B isn't attracted to species A but species A is avoiding species B. 

So, let's follow the analysis laid out by Parsons (2016) for coyote and our prey species. 

```{r analysis}
# Perform pairwise Wilcoxon tests
wilcox_test_result <- pairwise.wilcox.test(
  combined_ratios_long$Value,
  combined_ratios_long$Species,
  p.adjust.method = "bonferroni"  # Adjust p-values for multiple comparisons
)

 
# Print the results
print(wilcox_test_result)

```

The results of the Wilcox test show that the ratios were not statistically significant. But that doesn't mean that there isn't a response in attraction or avoidance, only that it wasn't statistically significant and we know that values >1 suggest nonrandom movement between the two species. 

This vignette shows how to implement the main functions in AvoidAttract to investigate species interactions using camera trapping data.


## References:

Parsons, A. W., C. Bland, T. Forrester, M. C. Baker-Whatton, S. G. Schuttler, W. J. McShea, R. Costello, and R. Kays. 2016.
The ecological impact of humans and dogs on wildlife in protected areas in eastern North America. Biological Conservation 203:75â€“88. URL: https://doi.org/10.1016/j.biocon.2016.09.001























